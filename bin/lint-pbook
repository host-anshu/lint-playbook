#!/usr/bin/env python

"""Script to execute linter"""

import sys

from linter.runner import Linter


def separate_args(args):
    """Separate linter and playbook args

    Return playbook args and change sys.argv to linter args
    """
    def separate_flags(lp_args):
        """Separate clubbed flags.

        This allows invoking as such:
            <lint-pbook -lt vars -- -i host playbook.yml>
        Here L and t are two different flags.
        """
        expanded = list()
        for item in lp_args:
            if len(item) < 3:
                # If at all a flag, must be single flag
                expanded.append(item)
                continue
            if item.startswith("-"):
                if not item.startswith("--"):
                    for flag in item[1:]:
                        expanded.append('-' + flag)
                    continue
            expanded.append(item)
        return expanded

    try:
        indx = args.index('--')
        lp_args, pb_args = args[:indx], ['ansible-playbook'] + args[indx + 1:]
    except ValueError:
        lp_args, pb_args = args, ['ansible-playbook']
    sys.argv = separate_flags(lp_args)
    return pb_args


def main(args):
    pb_args = separate_args(args)
    lp_obj = Linter(pb_args)
    lp_obj.parse()
    lp_obj.run()


if __name__ == "__main__":
    main(sys.argv)
